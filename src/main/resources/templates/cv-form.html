<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${cv.id == null} ? 'Yeni CV OluÅŸtur' : 'CV DÃ¼zenle'"></title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .form-step {
            display: none; /* VarsayÄ±lan olarak tÃ¼m adÄ±mlarÄ± gizle */
            padding: 20px 0;
            border-top: 1px solid #eee;
            margin-top: 15px;
        }
        .form-step.active {
            display: block; /* Aktif adÄ±mÄ± gÃ¶ster */
        }
        .step-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        .suggestion-tip {
            background-color: #f0f8ff; /* AÃ§Ä±k mavi */
            border-left: 5px solid #007bff;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 5px;
            font-style: italic;
            color: #333;
        }
        .submit-button, .next-button, .prev-button {
            width: auto !important;
            padding: 12px 25px;
        }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<div class="container">
    <h1 th:text="${cv.id == null} ? 'ğŸ¤– AI Destekli SmartCV OluÅŸturucu' : 'âœï¸ CV DÃ¼zenle ve Tekrar Analiz Et'"></h1>
    <p>CV'nizi adÄ±m adÄ±m oluÅŸturalÄ±m. Verilerinizi girdikÃ§e AI size anÄ±nda Ã¶neriler sunacak!</p>

    <form th:action="${cv.id == null} ? @{/generate-cv} : @{/update-cv}" th:object="${cv}" method="post" id="cvForm" class="cv-form">

        <input type="hidden" th:field="*{id}" />

        <div class="form-step active" id="step-1">
            <h2>1. AdÄ±m: Ä°letiÅŸim Bilgileri</h2>

            <div class="suggestion-tip">
                <p>ğŸ’¡ **Ã–neri:** CV'nizdeki bilgilerin gÃ¼ncel ve tutarlÄ± olmasÄ±, ilk izlenim iÃ§in kritiktir. Bir e-posta adresi ve gÃ¼ncel bir telefon numarasÄ± yeterlidir.</p>
            </div>

            <div class="form-group">
                <label for="name">Ad Soyad *</label>
                <input type="text" id="name" th:field="*{name}" placeholder="Ã–rn: Eren YÄ±lmaz" required>
            </div>
            <div class="form-group">
                <label for="email">E-posta Adresi *</label>
                <input type="email" id="email" th:field="*{email}" placeholder="ornek@mail.com" required>
            </div>
            <div class="form-group">
                <label for="phone">Telefon NumarasÄ±</label>
                <input type="tel" id="phone" th:field="*{phone}" placeholder="Ã–rn: +90 5XX XXX XX XX">
            </div>
        </div>

        <div class="form-step" id="step-2">
            <h2>2. AdÄ±m: Kariyer Ã–zeti</h2>

            <div class="suggestion-tip">
                <p>ğŸ’¡ **Ã–neri:** Kariyer Ã¶zetiniz, CV'nizin ilk 3 saniyesidir! En Ã¶nemli becerilerinizi ve deneyim yÄ±lÄ±nÄ±zÄ± vurgulayÄ±n.</p>
                <p>_Ã–rnek: "Spring Boot ve mikroservisler konusunda uzmanlaÅŸmÄ±ÅŸ, 2 yÄ±llÄ±k deneyime sahip, sonuÃ§ odaklÄ± Java geliÅŸtiricisiyim."_</p>
            </div>

            <div class="form-group">
                <label for="summary">KÄ±sa Ã–zet / Kariyer Hedefi</label>
                <textarea id="summary" th:field="*{summary}" rows="4" placeholder="Kendinizi kÄ±saca ve etkili bir ÅŸekilde Ã¶zetleyin."></textarea>
            </div>
        </div>

        <div class="form-step" id="step-3">
            <h2>3. AdÄ±m: Beceriler ve EÄŸitim</h2>

            <div class="suggestion-tip">
                <p>ğŸ’¡ **Ã–neri:** Becerilerinizi virgÃ¼lden Ã§ok, kullandÄ±ÄŸÄ±nÄ±z seviyeye gÃ¶re gruplayÄ±n. EÄŸitiminizi gÃ¼ncel ve en son olanÄ± Ã¶nce yazÄ±n.</p>
                <p>_Ã–rnek Beceri: "Java, Spring Boot (Ä°leri Seviye), PostgreSQL, Docker, AWS (Temel)"_</p>
            </div>

            <div class="form-group">
                <label for="skills">Beceriler * (VirgÃ¼lle AyÄ±rÄ±n)</label>
                <textarea id="skills" th:field="*{skills}" rows="4" placeholder="Ã–rn: Java, Spring Boot, PostgreSQL, Docker, Agile Metodolojisi" required></textarea>
            </div>
            <div class="form-group">
                <label for="education">EÄŸitim *</label>
                <textarea id="education" th:field="*{education}" rows="3" placeholder="Ã–rn: XYZ Ãœniversitesi, Bilgisayar MÃ¼hendisliÄŸi, 2025 (Mezuniyet YÄ±lÄ±)" required></textarea>
            </div>
        </div>

        <div class="form-step" id="step-4">
            <h2>4. AdÄ±m: Ä°ÅŸ Deneyimi</h2>

            <div class="suggestion-tip">
                <p>ğŸ’¡ **Ã–neri:** Deneyimlerinizi **sayÄ±larla** gÃ¼Ã§lendirin (metrik odaklÄ±). STAR metodunu kullanÄ±n: Durum, GÃ¶rev, Aksiyon, SonuÃ§ (Situation, Task, Action, Result).</p>
                <p>_Ã–rnek: "XYZ projesinde performansÄ± %30 artÄ±ran yeni bir mikroservis geliÅŸtirdim."_</p>
            </div>

            <div class="form-group">
                <label for="experience">Ä°ÅŸ Deneyimi</label>
                <textarea id="experience" th:field="*{experience}" rows="8" placeholder="En son iÅŸinizden baÅŸlayarak deneyimlerinizi detaylandÄ±rÄ±n."></textarea>
            </div>
        </div>

        <div class="step-navigation">
            <button type="button" class="button prev-button" onclick="changeStep(-1)" style="display: none;">â† Geri</button>
            <button type="button" class="button next-button" onclick="changeStep(1)">Ä°leri â†’</button>

            <button type="submit" class="submit-button" id="submitButton" style="display: none;" th:text="${cv.id == null} ? 'âš¡ AI ile CV OluÅŸtur ve Analiz Et' : 'ğŸ”„ GÃ¼ncelle ve Tekrar Analiz Et'"></button>
        </div>

    </form>
</div>

<script>
    let currentStep = 1;
    const totalSteps = 4;

    const formSteps = document.querySelectorAll('.form-step');
    const prevBtn = document.querySelector('.prev-button');
    const nextBtn = document.querySelector('.next-button');
    const submitBtn = document.getElementById('submitButton');

    // BaÅŸlangÄ±Ã§ta doÄŸru adÄ±mÄ± gÃ¶ster
    showStep(currentStep);

    function showStep(n) {
        // TÃ¼m adÄ±mlarÄ± gizle
        formSteps.forEach(step => {
            step.classList.remove('active');
        });

        // Ä°stenen adÄ±mÄ± gÃ¶ster
        document.getElementById(`step-${n}`).classList.add('active');

        // Navigasyon butonlarÄ±nÄ± gÃ¼ncelle
        updateNavigationButtons();
    }

    function updateNavigationButtons() {
        // Geri butonu: Sadece ilk adÄ±mda gizle
        prevBtn.style.display = currentStep === 1 ? 'none' : 'block';

        // Ä°leri butonu: Sadece son adÄ±mda gizle
        nextBtn.style.display = currentStep === totalSteps ? 'none' : 'block';

        // GÃ¶nder butonu: Sadece son adÄ±mda gÃ¶ster
        submitBtn.style.display = currentStep === totalSteps ? 'block' : 'none';

        // Navigasyon butonlarÄ±nÄ±n gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ne gÃ¶re yerleÅŸimi ayarla
        if (currentStep === totalSteps) {
             prevBtn.style.marginRight = 'auto'; // Geri butonu sola itilir
        } else if (currentStep === 1) {
             nextBtn.style.marginLeft = 'auto'; // Ä°leri butonu saÄŸa itilir
        } else {
             prevBtn.style.marginRight = '0';
             nextBtn.style.marginLeft = '0';
        }
    }

    function changeStep(n) {
        // GeÃ§erli adÄ±mdaki gerekli alanlarÄ± kontrol et (Sadece Ä°LERÄ° giderken)
        if (n === 1 && !validateCurrentStep()) {
            return; // DoÄŸrulama baÅŸarÄ±sÄ±z olursa ilerleme
        }

        // Yeni adÄ±m numarasÄ±nÄ± hesapla
        currentStep += n;

        // AdÄ±m sÄ±nÄ±rlarÄ±nÄ± kontrol et
        if (currentStep > totalSteps) {
            currentStep = totalSteps;
        } else if (currentStep < 1) {
            currentStep = 1;
        }

        showStep(currentStep);
    }

    function validateCurrentStep() {
        const currentStepElement = document.getElementById(`step-${currentStep}`);
        let isValid = true;

        // Sadece required (*) alanlarÄ±nÄ± kontrol et
        currentStepElement.querySelectorAll('[required]').forEach(input => {
            if (!input.value.trim()) {
                input.style.borderColor = 'red'; // Hata gÃ¶rseli
                isValid = false;
            } else {
                input.style.borderColor = '#ddd'; // Normal renk
            }
        });

        if (!isValid) {
            alert('LÃ¼tfen bu adÄ±mdaki tÃ¼m gerekli (*) alanlarÄ± doldurun.');
        }
        return isValid;
    }
</script>
</body>
</html>